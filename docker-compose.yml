services:
  # Client UI - Web interface for sending queries
  client-ui:
    build:
      context: ./client-ui
      dockerfile: Dockerfile
    ports:
      - "8080:8080"
    networks:
      - app-network
    restart: unless-stopped

  # Mock Seaglass - Simulates the Seaglass service
  mock-seaglass:
    build:
      context: ./mock-seaglass
      dockerfile: Dockerfile
    ports:
      - "8003:8003"
    environment:
      - MCP_PROXY_URL=http://mcp-proxy:8002
    depends_on:
      - mcp-proxy
    networks:
      - app-network
    restart: unless-stopped

  # Redis - In-memory storage for session context
  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    networks:
      - app-network
    restart: unless-stopped
    # Note: Persistence (RDB/AOF) can be added later if needed

  # MCP Proxy - Orchestrates Claude and MCP server
  mcp-proxy:
    build:
      context: ./mcp-proxy-service
      dockerfile: Dockerfile
    ports:
      - "8002:8002"
    environment:
      - MCP_SERVER_URL=http://sde-mcp-server:8001/mcp
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - CLAUDE_MODEL=${CLAUDE_MODEL:-claude-3-5-haiku-20241022}
      - ENABLE_TIMING=${ENABLE_TIMING:-false}
      - SDE_HOST=${SDE_HOST}
      - REDIS_HOST=redis
      - REDIS_PORT=6379
      - REDIS_DB=0
      - SESSION_TTL=86400
    depends_on:
      - sde-mcp-server
      - redis
    networks:
      - app-network
    restart: unless-stopped

  # SDE MCP Server - Existing MCP server
  sde-mcp-server:
    build:
      context: .
      dockerfile: Dockerfile.sde-mcp-server
    ports:
      - "8001:8001"
    environment:
      - SDE_HOST=${SDE_HOST}
      - SDE_API_KEY=${SDE_API_KEY}
    networks:
      - app-network
    restart: unless-stopped

networks:
  app-network:
    driver: bridge

